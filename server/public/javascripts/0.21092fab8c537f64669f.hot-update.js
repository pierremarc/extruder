webpackHotUpdate(0,{

/***/ "./extrude.js":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__lib_point__ = __webpack_require__(\"../lib/point.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__lib_state__ = __webpack_require__(\"../lib/state.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__lib_ctx_paper__ = __webpack_require__(\"../lib/ctx-paper.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__lib_operation__ = __webpack_require__(\"../lib/operation.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__draw__ = __webpack_require__(\"./draw.js\");\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = extrude;\n\n\n\n\n\n\n\nfunction getScaledSize(rect, bbox) {\n    var hScale = rect.width / bbox.width;\n    var vScale = rect.height / bbox.height;\n    var scale = 1;\n    var offset = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__lib_point__[\"a\" /* default */])(0, 0);\n\n    if (hScale < vScale) {\n        scale = hScale;\n        offset = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__lib_point__[\"a\" /* default */])(0, (rect.height - bbox.height * scale) / 2);\n    } else {\n        scale = vScale;\n        offset = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__lib_point__[\"a\" /* default */])((rect.width - bbox.width * scale) / 2, 0);\n    }\n\n    return {\n        width: bbox.width * scale,\n        height: bbox.height * scale,\n        offset: offset,\n        scale: scale\n    };\n}\n\nfunction extrudeLine(ctx, rect, x, y, text, font, fontSize) {\n    var anchor = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__lib_point__[\"a\" /* default */])(rect.minx, rect.miny);\n    var knockout = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__lib_state__[\"c\" /* getState */])('knockout', false);\n\n    var _draw = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__draw__[\"a\" /* default */])(text, font, fontSize, x, y, anchor),\n        extrusion = _draw.extrusion,\n        mask = _draw.mask;\n\n    if (knockout) {\n        (function () {\n            var paperEx = new __WEBPACK_IMPORTED_MODULE_2__lib_ctx_paper__[\"a\" /* default */]();\n            var maskOps = [];\n            mask.forEach(function (operation) {\n                var opCode = operation[0];\n                if (opCode === __WEBPACK_IMPORTED_MODULE_3__lib_operation__[\"a\" /* OP_BEGIN */]) {\n                    maskOps.push([]);\n                }\n                if (maskOps.length > 0) {\n                    maskOps[maskOps.length - 1].push(operation);\n                }\n            });\n            var masks = [];\n            maskOps.forEach(function (maskOp) {\n                var m = new __WEBPACK_IMPORTED_MODULE_2__lib_ctx_paper__[\"a\" /* default */](true);\n                __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__lib_operation__[\"b\" /* render */])(m, maskOp);\n                masks.push(m);\n            });\n\n            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__lib_operation__[\"b\" /* render */])(paperEx, extrusion);\n            masks.forEach(function (m) {\n                paperEx.substract(m);\n            });\n            var knockoutOps = paperEx.exportOperations();\n            // const a = knockoutOps.map((o) => o.join(':'));\n            // const b = extrusion.map((o) => o.join(':'));\n            // console.log('assert', a.length === b.length, difference(a, b));\n            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__lib_operation__[\"b\" /* render */])(ctx, knockoutOps);\n        })();\n    } else {\n        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__lib_operation__[\"b\" /* render */])(ctx, extrusion.concat(mask));\n    }\n}\n\nfunction extrude(ctx, state) {\n    var x = state.x,\n        y = state.y,\n        text = state.text,\n        font = state.font,\n        margin = state.margin,\n        width = state.width,\n        height = state.height;\n\n    var lines = text.split('\\n');\n\n    if (!font) {\n        return false;\n    }\n\n    if (lines.length > 0) {\n        (function () {\n            var scaledMargin = Math.max(margin * ctx.width, margin * ctx.height);\n            var innerWidth = ctx.width - scaledMargin * 2;\n            var innerHeight = ctx.height - scaledMargin * 2;\n            var lineHeight = innerHeight / lines.length;\n            var baseFactor = 0.8;\n            var fontSize = lineHeight;\n            var left = ctx.offset.x + scaledMargin;\n            var top = ctx.offset.y + scaledMargin;\n\n            var processLine = function processLine(line, idx) {\n                if (line.length > 0) {\n                    var rect = {\n                        minx: left,\n                        miny: top + idx * lineHeight + baseFactor * lineHeight,\n                        maxx: left + innerWidth,\n                        maxy: top + idx * lineHeight,\n                        width: innerWidth,\n                        height: lineHeight\n                    };\n                    // debug('line-rect', rect);\n                    extrudeLine(ctx, rect, x * ctx.scale, y * ctx.scale, line, font, fontSize);\n                }\n            };\n            if (y < 0) {\n                for (var idx = lines.length - 1; idx >= 0; idx -= 1) {\n                    processLine(lines[idx], idx);\n                }\n            } else {\n                lines.forEach(processLine);\n            }\n        })();\n    }\n\n    rawCtx.restore();\n    return true;\n}\n\n//////////////////\n// WEBPACK FOOTER\n// ./extrude.js\n// module id = ./extrude.js\n// module chunks = 0\n\n//# sourceURL=webpack:///./extrude.js?");

/***/ }),

/***/ "./tools.js":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__lib_ctx_canvas__ = __webpack_require__(\"../lib/ctx-canvas.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__lib_state__ = __webpack_require__(\"../lib/state.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__lib_dom__ = __webpack_require__(\"../lib/dom.js\");\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__extrude__ = __webpack_require__(\"./extrude.js\");\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = install;\n\n\n\n\n\n\nfunction fontName(font) {\n    return font.names.fullName.en;\n}\n\nfunction createfontItem(font) {\n    var name = font.names.fontSubfamily.en;\n    var elem = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('div', { class: 'tool-font-item clickable' });\n    elem.addEventListener('click', function () {\n        var nodeList = document.querySelectorAll('.tool-font-item-selected');\n        var selected = Array.prototype.slice.call(nodeList, 0);\n        selected.forEach(function (node) {\n            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"f\" /* removeClass */])(node, 'tool-font-item-selected');\n        });\n        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"g\" /* addClass */])(elem, 'tool-font-item-selected');\n        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__lib_state__[\"b\" /* setState */])('font', font);\n    });\n    var label = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('span');\n    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"e\" /* appendText */])(label, name);\n    elem.appendChild(label);\n    return elem;\n}\n\nfunction wrapTool(name, fn) {\n    var box = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('div', {\n        class: 'tool tool-' + name\n    });\n    var title = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('div', {\n        class: 'tool-title'\n    });\n    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"e\" /* appendText */])(title, name);\n    box.appendChild(title);\n\n    for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n        args[_key - 2] = arguments[_key];\n    }\n\n    fn.apply(undefined, [box].concat(args));\n    return box;\n}\n\nfunction fontTool(box, fonts) {\n    var groups = {};\n    var getGroup = function getGroup(font) {\n        var family = font.names.fontFamily.en;\n        if (!(family in groups)) {\n            var element = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('div', { class: 'font-family' });\n            var title = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('span', { class: 'font-family-title' });\n            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"e\" /* appendText */])(title, family);\n            element.appendChild(title);\n            box.appendChild(element);\n            groups[family] = element;\n        }\n        return groups[family];\n    };\n    fonts.forEach(function (font) {\n        var fontItem = createfontItem(font);\n        var group = getGroup(font);\n        group.appendChild(fontItem);\n    });\n}\n\nfunction textTool(box) {\n    var textArea = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('textarea', { class: 'tool-text-area' });\n    var text = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__lib_state__[\"c\" /* getState */])('text');\n    textArea.value = text;\n    textArea.addEventListener('keyup', function () {\n        if (textArea.value !== text) {\n            text = textArea.value;\n            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__lib_state__[\"b\" /* setState */])('text', text);\n        }\n    });\n    box.appendChild(textArea);\n}\n\nfunction exportTool(box) {\n    var knockout = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('input', {\n        type: 'checkbox',\n        value: 'knockout'\n    });\n\n    var exportPNG = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('a', {\n        class: 'tool-export-button',\n        download: 'extruded.png'\n    });\n    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"e\" /* appendText */])(exportPNG, 'Download PNG');\n\n    var exportPDF = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('a', {\n        class: 'tool-export-button',\n        download: 'extruded.pdf'\n    });\n\n    box.appendChild(knockout);\n    box.appendChild(exportPNG);\n    box.appendChild(exportPDF);\n\n    var offScreen = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('canvas');\n    var localState = null;\n    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__lib_state__[\"d\" /* onStateChange */])(function (state) {\n        localState = state;\n    });\n\n    knockout.addEventListener('change', function () {\n        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__lib_state__[\"b\" /* setState */])('knockout', knockout.checked);\n    });\n\n    exportPNG.addEventListener('mouseenter', function () {\n        if (localState) {\n            offScreen.width = localState.width;\n            offScreen.height = localState.height;\n            var ctx = new __WEBPACK_IMPORTED_MODULE_0__lib_ctx_canvas__[\"a\" /* default */](offScreen);\n            ctx.clear();\n            if (__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__extrude__[\"a\" /* default */])(ctx, localState)) {\n                exportPNG.href = offScreen.toDataURL('image/png');\n            }\n        }\n    });\n\n    exportPDF.addEventListener('mouseenter', function () {\n        if (localState) {\n            var ctx = new ContextPDF(localState.width, localState.height);\n            if (__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__extrude__[\"a\" /* default */])(ctx, localState)) {\n                exportPDF.href = offScreen.toDataURL('image/png');\n            }\n        }\n    });\n}\n\nfunction install(fonts) {\n    var sidebar = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"b\" /* createElement */])('div', { class: 'tool-box' });\n    var fontBox = wrapTool('font', fontTool, fonts);\n    var textBox = wrapTool('text', textTool);\n    var exportBox = wrapTool('export', exportTool);\n    // const xyBox = wrapTool('xy', xyTool);\n    // const extentBox = wrapTool('size', extentTool);\n\n\n    [textBox, fontBox, exportBox].forEach(function (box) {\n        return sidebar.appendChild(box);\n    });\n    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__lib_dom__[\"c\" /* body */])().appendChild(sidebar);\n    // body().appendChild(xyBox);\n    // body().appendChild(extentBox);\n}\n\n//////////////////\n// WEBPACK FOOTER\n// ./tools.js\n// module id = ./tools.js\n// module chunks = 0\n\n//# sourceURL=webpack:///./tools.js?");

/***/ })

})